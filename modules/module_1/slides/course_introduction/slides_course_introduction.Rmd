---
title: "Introduction to R for<br>Applied Epidemiology"
subtitle: "Welcome and course overview"
author: "March 2022"
date: '[contact@appliedepi.org](mailto:contact@appliedepi.org)'
output:
  xaringan::moon_reader:
    seal: TRUE
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    css: [xaringan-themer.css] 
---

```{r, eval=F, echo=F, include = F}
# Must do in order to render.

pacman::p_load(xaringan)
devtools::install_github("gadenbuie/xaringanExtra")
devtools::install_github("gadenbuie/countdown")
remotes::install_github("mitchelloharawild/icons")
icons::download_fontawesome()

# Render with xaringan::infinite_moon_reader()
# Slides will appear in viewer, and will update as you edit/save
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      fig.retina = 3  ## retina more effective than w/h (according to twitter)
                      # fig.width = 16, 
                      # fig.height = 10
                      )
## I dont know why this is included in the example xaringan slide 
## but is something to do with background images
options(htmltools.dir.version = FALSE)

## install and load necessary packages 
pacman::p_load(
  rio,        # importing data  
  here,       # relative file pathways  
  janitor,    # data cleaning and tables
  lubridate,  # working with dates
  tidyverse,  # data management and visualization
  gtsummary,  # summary tables
  flair,      # coloring text
  kableExtra, # for output tables
  xaringanthemer  # for styling presentation 
)

library(countdown)
```


```{r  xaringan-themer, include = FALSE}

## define presentation colours (theme) using {xaringanthemer} package 
## https://pkg.garrickadenbuie.com/xaringanthemer/articles/xaringanthemer.html

## epirhandbook logo colours: 
  ## blue: "#00538c"
  ## green: "#007732"
  ## lighter green: "#48a878"

## see ?style_mono_accent for all the things can customise
style_mono_accent(
  base_color = "#00538c", 
  link_color = "#48a878", 
  # add logo to the title page (bit bigger)
  title_slide_background_image = "https://github.com/appliedepi/intro_course/raw/main/images/logo.png",
  title_slide_background_position = "95% 95%",
  title_slide_background_size = "25%",
  ## add logo to all following slides
  background_image = "https://github.com/appliedepi/intro_course/raw/main/images/logo.png", 
  background_size = "10%",
  background_position = "100% 0%"
)
```

```{css, echo=F}
    .remark-slide table{
      border: none
    }
    .remark-slide-table {
      
    }
    tr:first-child {
      border-top: none;
  }
    tr:last-child {
    border-bottom: none;
  }
```


```{r, echo=F, eval=T}
surv <- rio::import(xfun::relative_path(here::here("data", "surveillance_linelist_clean.rds")))
```

# Thank you for joining us  

.left-column[

```{r, eval = TRUE, echo = FALSE, out.width = "55%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "instructors", "neale.png")))
```



```{r, eval = TRUE, echo = FALSE, out.width = "55%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "instructors", "paula.png")))
```



```{r, eval = TRUE, echo = FALSE, out.width = "55%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "instructors", "arran.png")))
```

]

.right-column[

* **Neale Batra**
President and co-founder, Applied Epi  
@MSF @WHO @CDC @USAID @Philly @CalEIS  
</br>
</br>

* **Paula Blomquist**  
@PHE @EPIET @WHO @PHRST
</br>
</br>


* **Arran Hamlet**  
@Imperial @WHO
</br>
</br>

]

Many other instructors will be joining us on this Pilot course  

.footnote[**Thank you for your service** *to your community in these busy times for public health. We are glad that you are taking the time to learn R with us.*]

???
Do a brief round of introductions  




---
# Learning R is...    

## ...really useful  

```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "stop_epidemic_dominoes2.png")))
```

???
Mention marketable skill as well as technically for epidemic response

---
# Learning R is...    

## ...freeing  

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "freedom_bird.png")))
```


---
# Learning R is...    

## ...sometimes hard work  

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "missing_puzzle.png")))
```

---
# Learning R is...    

## ...occassional moments of pure joy  

```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "joy.png")))
```


---
# Learning R is...    

## ...calling upon your creative side  

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "artistic.png")))
```

???
Many people think about coding as creating artwork... for example creating pottery, writing poems, painting, etc.  


---
# Learning R is...    

## ...joining an adventure with...

--

## ...an inspiring community of millions

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "many_people.png")))
```

???
Community of people who support free software, open-access tools, and democratizing and equalizing data science




---
class: inverse, center, middle

# Why use R? 


---
# Flexibility 

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "interoperability.png")))
```


???
- R can read and write to loads of different software/databases.
- Can hold multiple datasets at once
- Can also produce many different outputs  
- Automated and reproducible workflows (saves you time and headache)  

---
# Popularity 
.center[

```{r, eval = TRUE, echo = FALSE, out.width = "65%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "r_popularity.png")))
```

]


???
- R is free - and yet can do more than what expensive licensed software can  
- Previously limited to academic statisticians - R was not "trusted"  
- But now even pharma companies (e.g. GSK) and regulators are making the switch  
- It is the most widely used statistical programming language. 

---
# Learning curve 

R has become easier to learn in the last 5 years

.pull-left[
- Friendlier user interface (RStudio)
- Simpler syntax ("tidyverse")
- Free resources & interactive tutorials available  
    - **Epidemiologist R Handbook**
    - **R 4 Data Science**
    - **R epidemiology case studies**
]

.pull-right[

```{r difficulty_plot, warning = FALSE, message = FALSE}
exp <- function(x){x^2}
lgr <- function(x){log(x) + 4}
num <- 10000
linwid <- 2
ggplot() + 
  geom_function(fun = exp,
                n = num, 
                size = linwid,
                aes(colour = "Excel")) +
  geom_function(fun = lgr, 
                n = num, 
                size = linwid,
                aes(colour = "R")) + 
  scale_y_continuous(expand = c(0, 0), 
                     limits = c(0, 10)) + 
  scale_x_continuous(expand = c(0, 0), 
                     limits = c(0, 5)) + 
  labs(x = "Code complexity", 
       y = "Task difficulty") + 
  theme_classic(base_size = 24) + 
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(), 
        legend.position = "bottom", 
        legend.title = element_blank())
```

]

???
- There is a bit of a learning curve - as with any software.  
- But we are here to get you over that initial hump so you can keep developing. 

---
# User community 

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "user_community.png")))
```


???
- **The internet is your friend.**  
- Once you get to grips with the basics - people answer literally any question on **stackoverflow!**  
- **Epi R Handbook**  

---
# Data visualization 


```{r, eval = TRUE, echo = FALSE, out.width = "90%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "visualization.png")))
```

.footnote[
Slide source: Paula Bianca Blomquist  
]

???
- Data viz essential to understand disease surveillance trends and outbreaks  
- **One of R's strongest features**  
- Network diagrams, maps, heat maps, integrated figures, the list goes on...  

---
# Automated surveillance reports 

.pull-left[
- Daily COVID-19 reports by Public Health England  
  - Reports sent to 317 local authorities  
  - Guide local investigations  
  - *R* bringing together data on:  
      - cases, testing, mortality & many others  
  - Caters to authorities needs  
      - MS word to be editable  
      - Integrated in to local reports  
]

.pull-right[

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "automated_reports.png")))
```

]

.footnote[
Slide source: Paula Bianca Blomquist  

See [Epi R Handbook chapter](https://epirhandbook.com/organizing-routine-reports.html) on organizing routine reports
]

???
- Producing reports at scale, an example from our EpiRHandbook colleague Paula
- Not a fancy report, flat word document but caters to specific needs! 
- **Key example of local intelligence and no way could do without the power of R**

---
# Automated surveillance outputs 
### WHO COVID-19 interactive {shiny} dashboard
.center[

```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "automated_dashboard.png")))
```

]

.footnote[
Slide source: Paula Bianca Blomquist & [World Health Organization](https://worldhealthorg.shinyapps.io/covid/)  

See [Epi R Handbook chapter](https://epirhandbook.com/dashboards-with-shiny.html) on organizing shiny dashboards
]

???
- WHO COVID-19 public-facing dashboard  
- Made with a package called {shiny} to build interactive web apps/dashboard  
- Can see toggles and interactive tabs here  
- Pulls from dozens of data sources to displace data by countries/regions 
- There is a section in the handbook on shiny



---
## About Applied Epi

We are **elevating frontline epidemiology**

Our team of **150 practitioners** live in over **35 countries**. 

.pull-left[
- Local government epidemiologists and public health practitioners
- Emergency responders
- Data science educators
- Applied researchers
- Clinicians
- GIS experts...

]

.pull-right[

```{r, eval = TRUE, echo = FALSE, out.width = "200%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "team_locations.jpg")))
```

]


We too have been working overtime on COVID response...<br>*and we believe that accelerating public health's transition to R is really important.*

---
# A global grassroots movement

Some faces from our broader team

```{r, eval = TRUE, echo = FALSE, out.width = "120%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "team_faces.png")))
```


---
# Partnerships

We work closely with local and global entities to support people doing the hard work of public health practice


```{r, eval = TRUE, echo = FALSE, out.width = "80%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "partners-blur.jpg")))
```



???
- What makes us different is that we focus on the challenges of applied epi, not academic epi. We emphasize the skills used every day by ground-level epidemiologists. 


---

# Our offerings

A comprehensive suite of services

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "Applied_Epi_Offerings.png")))
```





---

# The Epidemiologist R Handbook

```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "Epi R Handbook Banner Beige 1500x500.png")))
```

- 50 chapters of free best-practice code examples - available online and offline
- 130,000 users globally (35,000 in low & middle-income countries)
- Being translated into 10 languages


> *"The epidemiologist greatest companion"* <br> - Epidemiologist, Nigeria CDC

> *"[It] weaves together so much, so succinctly, and so incredibly clearly"* <br> - Epidemiologist, US CDC






---
# Your backgrounds

Quick introductions  

- Name, institution, and role  
- The analytical software you are most comfortable in  
- The most recent good meal that you ate  


---
# Your perceptions and hopes

- "I see that R is just more commonly used, especially in the humanitarian field"  
- "it can automatize a lot of work which is appealing"  
- "it is helping in the automated routine and deep analysis"  
- "I am hoping to get more data wrangling practice"  
- "use R to do descriptive data analysis and a little bit more complicated stuff if the need arises"  
- "It will give me some confidence in quant work."  
- "R skills in outbreak and humanitarian settings."  



---
# Your perceptions and fears


- "I don't believe it to be true, I've heard that R is exceedingly hard to learn and use"  
- "has a learning curve with lots of time needed to debug the code you've written"  
- "R has a steep learning curve"  




---
# Course objectives

We want to help you:  

- Achieve a basic competency to use R for data management and visualization  

--

- Understand how R evolves and be equipped for sustained self-learning  

--

- Have experience applying R to a variety of datasets

--

- Feel comfortable producing basic automated reports with R Markdown  



---
# Course format

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "welcome", "IntroCourseTimeline2.png")))
```

35 hours of synchronous time together  

- **Part 1. Classroom instruction** 8 half-day modules

- **Part 2. Sustained support** Five 1.5-hour follow-up group support sessions to help you apply R to your work context

.footnote[We offer subscription **"R Help Desk"** services for further on-call support]

---
# Course schedule

```{r, echo=FALSE, warning=F, message=F}
outline <- dplyr::tribble(
  ~Module, ~Date, ~Topic,
  "1", "Mo 21/3",  "Welcome, RStudio, basic syntax, data import",
  "2", "Mo 21/3",  "Cleaning data, core R functions, piping",
  "3", "Tu 22/3",  "Grouping and summarising data",
  "4", "Tu 22/3",  "Data visualization with ggplot2",
  "5", "We 23/3",  "Transforming data with joins and pivots",
  "6", "We 23/3",  "Heat plots, epi curves, age/sex pyramids, GIS demo",
  "7", "Th 24/3",  "R Markdown reports",
  "8", "Th 24/3",  "Real-life exercise"
)

outline %>% 
  flextable::qflextable()
```

- Each module will begin with a brief review of the previous module, and will end with a plenary debrief.  
- Between modules, you will be asked to write answers to two self-reflective questions in the [Applied Epi Community](www.community.appliedepi.org) class thread.  


---
# Today: objectives & schedule  

**In this module we aim to help you:**  
* Understand R within the ecosystem of analytical tools  
* Navigate RStudio and R projects  
* Write a basic R script to load packages, import data, and view a dataset  


```{r, echo=FALSE, warning=F, message=F}
outline <- dplyr::tribble(
  ~Time, ~Location, ~Topic,
  "20 minutes",     "Main",      "Welcome, course logistics, Why R?",
  "10 minutes",     "Main",      "Demo: RStudio tour and basic R syntax",
  "20 minutes",     "Main",      "Function, packages, file paths, importing",
  "1h 45 minutes",  "Breakouts", "Exercise",
  "20 minutes",     "Main",      "Plenary debrief"
)

outline %>% 
  flextable::qflextable() %>% 
  flextable::add_footer_lines("Breaks are incorporated above, but not shown as rows")
```

???
Note stretch breaks throughout.


---
# Data used in this course  

* Ebola case study  
     * Surveillance linelist  
     * Hospital linelists from 5 hospitals  
     * Aggregated case counts from one hospital  
     * Case investigation dataset  
     * Lab dataset  

* Near the end of the course, you will apply your skills to a COVID dataset  

.footnote[All data are not real. All files can be found in the course folder.]  



---
# Breakouts and support  

- **General pattern:** Brief explanation -> Live demonstration -> breakout exercises -> plenary debrief  

--

- **Assistant instructors** will facilitate breakout groups and lead plenary debriefs  

--

- **Screen fatigue is real** - you are welcome to turn off your video, but please try to keep video on in breakout discussions  

--

- **Post questions in the Meet Q&A tool** - an instructor will be monitoring and will answer in the chat or verbally  

--

- **Extra support** is available during lunch, in a breakout room, for participants who are confused  





---
# Agreement with each other 

**Our team will:**  

--

- Create an affirming, supportive learning space

--

- Provide personalized attention, as much as possible  

--

- Allow you space to explore and "tinker" as you learn

--

- Appreciate your expertise

--

**We hope that you will:**  

--

- Reach outside of your comfort zone *(you might discover a new passion!)*  

--

- Try to attend all the sessions, and catch-up if you miss  

--

- Keep trying  

--

- Tell us if you do not understand  

--

- Be supportive of fellow participants  

???
We are in this course to succeed, together




---
class: inverse, center, middle  

# Stretch break!

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "breakout", "stretch.png")))
```

```{r}
countdown(minutes = 5, seconds = 00)
```



---
class: inverse, center, middle  

# Live demonstration  

## RStudio and basic syntax  

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "piano_man.jpg")))
```

---
class: inverse, center, middle

.pull-left[
## Functions: 
## Tools to help you accomplish a specific task 
]

.pull-right[

```{r, eval = TRUE, echo = FALSE, out.width = "75%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "function_tools_pliers.png")))
```

]

---
# Functions   
### Inputs and outputs  

- A function is like a machine that:  
     - Receives inputs
     - Does some action with the inputs  
     - Returns an output  

--

- Functions have a name (*hopefully intuitive!*), and have parentheses ( )  
     * `print()` helps you print an R object
     * `mean()`  averages some values
     * `filter()` removes certain rows in a dataset using logical criteria

.footnote[functions also appear in Excel as *equations*]


---
# Does this look familiar?  

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "excel_functions.png")))
```

R **functions** are similar to Excel **equations**  

  * They accept inputs within **parentheses**  
  * The inputs are separated by **commas**  



---
# Simple R functions  

.pull-left[

- `sqrt()`  

  * Accepts one numeric value as input, returns the square root

]

.pull-right[
```{r, echo=T, out.width="100%"}
sqrt(49)
```

]

.footnote[Note the [1] that appears: it is this command's  1st (and only) output in the R console]

???
Demonstrate each `sqrt(49)`, `sqrt(12)`, `max(1, 15, 2, 9)` (explain commas)
Explain vectors `c(1, 15, 2, 9)` and a named vector `cities <- c("Wuhan", "Milan", "New York")`
Quickly note indexed vectors `cities[[2]]`
and numeric: `ages <- c(15, 28, 100, 15, 65, 4, 10)` then `summary(ages)` and `summary(ages)[2]` and `summary(ages)[[2]]`



---
# Simple functions

.pull-left[

- `sqrt()`  
  * Accepts one numeric value as input, returns the square root

- `max()`  
  * Accepts numeric values and returns the maximum


]

.pull-right[
```{r, echo=T, out.width="100%"}
sqrt(49)
```
<br>
```{r, echo=T, out.width="100%"}
max(2, 10, 15, 200, 9)
```

]

.footnote[These are examples of functions in "*base R*" - functions that come installed with R.]

???
Demonstrate each `sqrt(49)`, `sqrt(12)`, `max(1, 15, 2, 9)` (explain commas)
Explain vectors `c(1, 15, 2, 9)` and a named vector `cities <- c("Wuhan", "Milan", "New York")`
Quickly note indexed vectors `cities[[2]]`
and numeric: `ages <- c(15, 28, 100, 15, 65, 4, 10)` then `summary(ages)` and `summary(ages)[2]` and `summary(ages)[[2]]`


---
# Simple functions

.pull-left[

- `sqrt()`  
  * Accepts one numeric value as input, returns the square root
<br>

- `max()`  
  * Accepts numeric values and returns the maximum
<br>

- `c()`  
  * Shorthand for "concatenate"  
  * Combines inputs into a *vector*  
]

.pull-right[
```{r, echo=T, out.width="100%"}
sqrt(49)
```
<br>

```{r, echo=T, out.width="100%"}
max(2, 10, 15, 200, 9)
```

```{r, echo=T, out.width="100%"}
c(2, 5, 9, 12, 47)
```
]

.footnote[These are examples of functions in "*base R*" - functions that come installed with R.]

???
Demonstrate each `sqrt(49)`, `sqrt(12)`, `max(1, 15, 2, 9)` (explain commas)
Explain vectors `c(1, 15, 2, 9)` and a named vector `cities <- c("Wuhan", "Milan", "New York")`
Quickly note indexed vectors `cities[[2]]`
and numeric: `ages <- c(15, 28, 100, 15, 65, 4, 10)` then `summary(ages)` and `summary(ages)[2]` and `summary(ages)[[2]]`







---
# Arguments  

.pull-left[


But most functions are not so simple.  

</br>

They must be told *how* to work, and *on what* to work.  

</br>


You specify these values to their **"arguments"**.  

</br>


Arguments are like inputs and settings, with *names* to distinguish them:

]


.pull-right[

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "arguments-buttons.png")))
```

]



---

# This may look familiar  

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "excel_arguments.png")))
```

Once again, Excel is not so different from R:  
  * Arguments have names and are separated by commas  

--

  * Values supplied can be numeric (12) or character ("Apple")  
  
--

  * Some arguments are optional  
  
--
  
  * They can reference other values  
  


???
What is returned by this Excel equation?




---
# Baking example

--

Let us pretend that `oven_bake()` is a function we are using to bake bread.  
What *arguments* might this function take?

- hint: what *object* needs to be put in the oven? Which *settings* must be adjusted?

--

```{r, eval = TRUE, echo = FALSE, out.width = "100%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "Function_Bread_Example.png")))
```




---
# Example  

Imagine we have this dataset imported into R, saved with the name **`surv`**.  

We want to create a cross-tabulation of the columns `case_def` and `gender`.  

```{r include=FALSE}
surv <- surv %>% 
     select(case_def, gender, age) %>% 
     head(8)
```

```{r, echo=F, eval=T}
surv %>% knitr::kable()
```



---
# The `tbl_cross()` function 

```{r, results = "asis", echo = FALSE}
"tbl_cross() requires us to supply 3 arguments, to create a cross-tabulation:" %>%
  flair("tbl_cross()", color = "cornflowerblue") %>%
  flair("arguments", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

Here is the function, with no values provided to the arguments.  


```{r, results = "asis", echo = FALSE}
"tbl_cross(data =        , row =        , col =        )" %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("data =", color = "orange") %>%
  flair("col =", color = "orange") %>%
  flair("row =", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

---
# The `tbl_cross()` function 

```{r, results = "asis", echo = FALSE}
"tbl_cross() requires us to supply 3 arguments, to create a cross-tabulation:" %>%
  flair("tbl_cross()", color = "cornflowerblue") %>%
  flair("arguments", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

The dataset we want to cross-tabulate is named `surv`  


```{r, results = "asis", echo = FALSE}
"tbl_cross(data = surv, row =       , col =         )" %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("data =", color = "orange") %>%
  flair("col =", color = "orange") %>%
  flair("row =", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```


---
# The `tbl_cross()` function 

```{r, results = "asis", echo = FALSE}
"tbl_cross() requires us to supply 3 arguments, to create a cross-tabulation:" %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("arguments", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

We want the `gender` values to form the rows of the cross-table 

```{r, results = "asis", echo = FALSE}
"tbl_cross(data = surv, row = gender, col =         )" %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("data =", color = "orange") %>%
  flair("col =", color = "orange") %>%
  flair("row =", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```










---
# The `tbl_cross()` function 


```{r, results = "asis", echo = FALSE}
"tbl_cross() requires us to supply 3 arguments, to create a cross-tabulation:" %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("arguments", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

We want the `case_def` values to form the columns of the cross-table 

```{r, results = "asis", echo = FALSE}
"tbl_cross(data = surv, row = gender, col = case_def)" %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("data =", color = "orange") %>%
  flair("col =", color = "orange") %>%
  flair("row =", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```



---
# The `tbl_cross()` function 

```{r, results = "asis", echo = FALSE}
"tbl_cross() requires us to supply 3 arguments, to create a cross-tabulation:" %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("arguments", color = "orange") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

Running the command produces the table!  

```{r tblcross, include = F}
tbl_cross(data = surv, row = gender, col = case_def)
```

```{r tblcross_flair, echo=F}
decorate("tblcross") %>%
  flair("tbl_cross(", color = "cornflowerblue") %>%
  flair("data =", color = "orange") %>%
  flair("col =", color = "orange") %>%
  flair("row =", color = "orange") %>%
  knit_print.with_flair()
```




---
# Packages  

The functions `sqrt()`, `sum()`, and `c()` are ready-to-use when you install R.  

These are called {base} R functions, but are only a small portion of R.  

However, most functions you will use must be downloaded in an R **package**.  

--

For example, `tbl_cross()` is contained in the R package named {gtsummary}.  

.pull-left[

R packages are often referred to in {brackets} and have "hex" logos.  

]

.pull-right[
```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "gt_summary.png")))
```
]

---

# Packages

An R package is a *shareable bundle of related functions* that you can download and use. Packages typically have a theme, for example:


* {ggplot2} is the most common data visualization package  
* {lubridate} makes it easier to work with dates  
* {janitor} help clean and summarize data  
* {rmarkdown} help you write documents and make dashboards  

```{r, eval = TRUE, echo = FALSE, out.width = "20%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "ggplot2.png")))
knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "lubridate.png")))
knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "janitor.png")))
knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "rmarkdown.png")))


```


---
# Install vs. Load  

**Step 1 - Install:** A package is **installed once** and stored in your R “library”.  
  * The package is like a "book" of functions which you buy for your library.  
     
--

**Step 2 - Load:** Begin **every R session** by "loading" the packages you want to use  
  * This is like borrowing the books from your library  
  
```{r, eval = TRUE, echo = FALSE, out.width = "40%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.
knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "bookshelf1.png")))
```





---
# {pacman}  

This package help you manage the install/loading of other packages.  

* **{pacman}** = **pac**kage **man**ager 

It installs the package (if necessary) **and** loads it for use in the current R session.  





---
# Which code is more simple?  

Both of these codes install and load the same packages.  

.pull-left[

Using {base} R  

```{r, eval=F, echo=T}
install.packages(
     c("rio",
       "janitor",
       "gtsummary",
       "here",
       "tidyverse"))

library(rio)
library(janitor)
library(gtsummary)
library(here)
library(tidyverse)
```


]

.pull-right[

Using {pacman}  

```{r, eval=F, echo=T}
pacman::p_load(
  rio,
  janitor,
  gtsummary,
  here,
  tidyverse)
```

]

.footnote[We show you this, because you will encounter {base} in your collaborations with others]

???
This is common R, where there are many ways do a task. Our job is boil it all down and share with you the easiest and most simple approaches.  

---
# Importing data with {rio}  

Importing data into R **used to be** painful  

You had to remember one function for each type of file: `read.csv()`, `read_excel()`, `read_xlsx()`...  

--

The {rio} package makes it easy with only one function: **`import()`**  

```{eval=F}
import("surveillance_linelist_20141201.csv")
```

.pull-left[
"rio" is shorthand for  
"R inputs/outputs"  
]

.pull-right[

```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.
knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "rio.png")))
```
]

---
# RStudio projects  



.pull-left[

An RStudio project is a self-contained and portable R working environment.  

It is a folder with all the files associated with a distinct project:  
* Data files  
* R scripts  
* Outputs  
* etc.

This makes your life immensely easier.  
]

.pull-right[
```{r, eval = TRUE, echo = FALSE, out.width = "85%"}
# Using here() alone won't work because Rmd folder becomes the rendering root.
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.
knitr::include_graphics(xfun::relative_path(here::here("images", "functions_packages", "project_briefcase.png")))
```
]

???
We will help 
You can zip the folder and share it with a colleague, it can be hosted on a shared drive, and can be synced with a Github repository.  

---
# File paths  

Let's try to import a dataset "linelist.csv" into R!  

--

Will this "absolute" file path work on your computer? Or will it "break"?  

```{r, eval=F, echo=T}
import("C:\Users\Laura\Documents\intro_course\data\clean\linelist.csv")
```

--

Mostly likely, it will not work.  

--

This is why we use RStudio project & the {here} package for relative file paths  


---
# {here}  

.pull-left[

With {here}, file paths are ***relative* to the RStudio project root folder**.  

The path *begins* at the R project. Everything before is flexible.  


]

.pull-right[

* `r emo::ji("folder")` intro_course (R project folder)  
     * intro_course.Rproj  
     * .here  
     * `r emo::ji("folder")` data  
          * `r emo::ji("folder")` clean  
               * `r emo::ji("document")` **linelist.csv**
          * `r emo::ji("folder")` raw  
     * `r emo::ji("folder")` scripts
]

--

The command **`here("data", "clean", "linelist.csv")`**  

produces this file path on Laura's computer:  

`"C:\Users\Laura\Documents\intro_course\data\clean\linelist.csv"`  

--

and produces *this* on Rajiv's Mac computer:  

`"home/Rajiv/docs/intro_course/data/clean/linelist.csv"`  



---
# {here} and {rio} together  

Finally, we can combine `import()` and `here()` to create a command that is truly versatile:  

```{r, echo=T, eval=F}
import(here("data", "clean", "linelist.csv"))
```

It is also agnostic in terms of slash direction ( / vs. \\ )  

We can zip this R project and email to a colleague, and this command will correctly import the data no matter where the R project is stored on their computer.  


.footnote[
See the [EpiRHandbook section on here package](https://epirhandbook.com/import-and-export.html?q=here#here) and on [EpiRHandbook section on importing data](https://epirhandbook.com/en/import-and-export.html)
]





---
class: inverse, center, middle



## Breakout  


```{r, eval = TRUE, echo = FALSE, out.width = "50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "breakout", "teamwork2.png")))
```

